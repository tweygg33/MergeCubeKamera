<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Multi-Marker Example</title>
    <!-- Include A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>AR.js Multi-Marker Example</h2>
        <p>Point your camera at the markers to see the model rotate seamlessly.</p>
    </div>

    <a-scene embedded arjs='sourceType: webcam;'>
        <!-- Multi-Marker Entity: All Markers work together -->
        <a-entity multi-marker="type: pattern; url: multiMarkerFile.json" id="multiMarker">
            <!-- GLB Model: Porsche, initially hidden -->
            <a-entity
              id="porscheModel"
              gltf-model="url(free_porsche_911_carrera_4s.glb)"
              scale="0.4 0.4 0.4"
              position="0 0 0"
              rotation="0 0 0"
              visible="false">
            </a-entity>
        </a-entity>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        AFRAME.registerComponent('marker-visibility-handler', {
            init: function () {
                const model = document.getElementById('porscheModel');  // Reference to the Porsche model
                const multiMarkerEntity = this.el;  // The multi-marker entity

                // Show the model when a marker is detected
                multiMarkerEntity.addEventListener('markerFound', () => {
                    console.log('Marker detected');
                    model.setAttribute('visible', 'true');
                });

                // Hide the model when no marker is detected
                multiMarkerEntity.addEventListener('markerLost', () => {
                    console.log('Marker lost');
                    model.setAttribute('visible', 'false');
                });
            }
        });

        // Attach the component to the multi-marker entity
        document.getElementById('multiMarker').setAttribute('marker-visibility-handler', '');

        async function initFrontCamera() {
            const constraints = {
                video: {
                    facingMode: { ideal: 'user' }, // Front camera
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.createElement('video');
                video.srcObject = stream;
                video.setAttribute('autoplay', '');
                video.setAttribute('muted', '');
                video.setAttribute('playsinline', '');
                document.body.appendChild(video);

                // Wait for the video stream to be ready
                video.onloadedmetadata = () => {
                    const arSystem = document.querySelector('a-scene').systems['arjs'];
                    arSystem.sourceElement = video;
                    arSystem._initSource = function () {
                        this.context.arController.setVideo(video);
                        this.context.arController.setup(video);
                    };
                    arSystem.start();
                };
            } catch (error) {
                console.error('Error accessing front camera:', error);
            }
        }

        window.onload = () => {
            initFrontCamera();
        };
    </script>
</body>
</html>
